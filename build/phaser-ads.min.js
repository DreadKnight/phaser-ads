/*!
 * phaser-ads - version 0.1.0-alpha3 
 * A Phaser plugin for providing nice ads integration in your phaser.io game
 *
 * OrangeGames
 * Build at 17-05-2016
 * Released under MIT License 
 */

var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Fabrique;!function(a){var b;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.onAdStarted=new Phaser.Signal,this.onAdFinished=new Phaser.Signal,this.onContentPaused=new Phaser.Signal,this.onContentResumed=new Phaser.Signal,this.onAdClicked=new Phaser.Signal,this.onAdError=new Phaser.Signal,this.onAdReady=new Phaser.Signal,this.provider=null,Object.defineProperty(b,"ads",{value:this})}return __extends(b,a),b.prototype.setAdProvider=function(a){this.provider=a,this.provider.setManager(this)},b.prototype.showAd=function(){null!==this.provider&&this.provider.playAd()},b.prototype.hideAd=function(){null===this.provider},b}(Phaser.Plugin);a.AdManager=b}(b=a.Plugins||(a.Plugins={}))}(Fabrique||(Fabrique={}));var Fabrique;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e){if(this.googleEnabled=!1,this.canPlayAds=!1,this.adTagUrl="",this.adManager=null,"undefined"!=typeof google){if(this.googleEnabled=!0,this.adContent=document.getElementById(c),this.adContent.style.display="none",this.gameContent=document.getElementById(b),this.gameContent.currentTime=100,this.adTagUrl=d,this.game=a,void 0!==e){var f="";for(var g in e){f.length>0&&(f+="&");var h=Array.isArray(e[g])?e[g].join(","):e[g];f+=g+"="+h}this.adTagUrl+="&cust_params="+encodeURIComponent(f)}this.createAdDisplayContainer(),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale("nl")}}return a.prototype.playAd=function(){if(!this.googleEnabled||!this.canPlayAds)return void this.adManager.onAdFinished.dispatch();this.adDisplay.initialize();try{this.adContent.style.display="block",this.adsManager.init(this.game.width,this.game.height,google.ima.ViewMode.NORMAL),this.adsManager.start()}catch(a){this.adContent.style.display="none",console.log("ad error!!!!",a),this.adManager.onAdError.dispatch(a)}},a.prototype.setManager=function(a){var b=this;if(this.adManager=a,!this.googleEnabled)return void this.adManager.onAdReady.dispatch();this.adLoader=new google.ima.AdsLoader(this.adDisplay),this.adLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(a){return b.onAdManagerLoader(a)},!1),this.adLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(a){console.log("No ad available",a),b.adManager.onAdReady.dispatch()},!1);var c=new google.ima.AdsRequest;c.adTagUrl=this.adTagUrl,c.linearAdSlotWidth=this.game.width,c.linearAdSlotHeight=this.game.height,c.nonLinearAdSlotWidth=this.game.width,c.nonLinearAdSlotHeight=this.game.height,c.forceNonLinearFullSlot=!0;try{this.adLoader.requestAds(c)}catch(d){this.adManager.onAdReady.dispatch()}},a.prototype.createAdDisplayContainer=function(){this.adDisplay=new google.ima.AdDisplayContainer(this.adContent,this.gameContent)},a.prototype.onAdManagerLoader=function(a){var b=this,c=new google.ima.AdsRenderingSettings;c.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.canPlayAds=!0,this.adsManager=a.getAdsManager(this.gameContent,c),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(a){return b.onAdError.call(b,a)}),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdEvent.bind(this)),this.adManager.onAdReady.dispatch()},a.prototype.onAdEvent=function(){console.log("onAdEvent",arguments),this.adManager.onContentResumed.dispatch()},a.prototype.onContentPauseRequested=function(){console.log("onContentPauseRequested",arguments),this.adManager.onContentPaused.dispatch()},a.prototype.onContentResumeRequested=function(){console.log("onContentResumeRequested",arguments),this.adContent.style.display="none",this.adManager.onAdFinished.dispatch()},a.prototype.onAdError=function(a){console.log("error",a.getError()),this.adManager.onAdError.dispatch(a.getError())},a}();a.AdSense=b}(b=a.AdProvider||(a.AdProvider={}))}(Fabrique||(Fabrique={}));var AdManager=Fabrique.Plugins.AdManager;