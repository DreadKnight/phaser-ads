/*!
 * phaser-ads - version 0.6.6 
 * A Phaser plugin for providing nice ads integration in your phaser.io game
 *
 * OrangeGames
 * Build at 16-06-2016
 * Released under MIT License 
 */

var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Fabrique;!function(a){var b;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.onContentPaused=new Phaser.Signal,this.onContentResumed=new Phaser.Signal,this.onAdClicked=new Phaser.Signal,this.provider=null,Object.defineProperty(b,"ads",{value:this})}return __extends(b,a),b.prototype.setAdProvider=function(a){this.provider=a,this.provider.setManager(this)},b.prototype.requestAd=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];null!==this.provider&&this.provider.requestAd.apply(this.provider,a)},b.prototype.preloadAd=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];null!==this.provider&&this.provider.preloadAd.apply(this.provider,a)},b.prototype.destroyAd=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];null!==this.provider&&this.provider.destroyAd.apply(this.provider,a)},b.prototype.hideAd=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];null!==this.provider&&this.provider.hideAd.apply(this.provider,a)},b}(Phaser.Plugin);a.AdManager=b}(b=a.Plugins||(a.Plugins={}))}(Fabrique||(Fabrique={}));var Fabrique;!function(a){var b;!function(a){!function(a){a[a.Interstitial=0]="Interstitial",a[a.Video=1]="Video",a[a.Rewarded=2]="Rewarded",a[a.Banner=3]="Banner"}(a.HeyzapAdTypes||(a.HeyzapAdTypes={}));var b=a.HeyzapAdTypes,c=function(){function a(a,b){var c=this;this.adsEnabled=!1,(a.device.cordova||a.device.crosswalk)&&(this.adsEnabled=!0,HeyzapAds.start(b).then(function(){},function(a){c.adsEnabled=!1}))}return a.prototype.setManager=function(a){this.adManager=a},a.prototype.requestAd=function(a,c){var d=this;switch(this.adsEnabled||this.adManager.onContentResumed.dispatch(),a){case b.Interstitial:HeyzapAds.InterstitialAd.addEventListener(HeyzapAds.InterstitialAd.Events.HIDE,function(){d.adManager.onContentResumed.dispatch(HeyzapAds.InterstitialAd.Events.HIDE)}),HeyzapAds.InterstitialAd.addEventListener(HeyzapAds.InterstitialAd.Events.SHOW_FAILED,function(){d.adManager.onContentResumed.dispatch(HeyzapAds.InterstitialAd.Events.SHOW_FAILED)}),HeyzapAds.InterstitialAd.addEventListener(HeyzapAds.InterstitialAd.Events.CLICKED,function(){d.adManager.onAdClicked.dispatch(HeyzapAds.InterstitialAd.Events.CLICKED)}),HeyzapAds.InterstitialAd.show().then(function(){d.adManager.onContentPaused.dispatch()},function(a){d.adManager.onContentResumed.dispatch()});break;case b.Video:HeyzapAds.VideoAd.addEventListener(HeyzapAds.VideoAd.Events.HIDE,function(){d.adManager.onContentResumed.dispatch(HeyzapAds.VideoAd.Events.HIDE)}),HeyzapAds.VideoAd.addEventListener(HeyzapAds.VideoAd.Events.SHOW_FAILED,function(){d.adManager.onContentResumed.dispatch(HeyzapAds.VideoAd.Events.SHOW_FAILED)}),HeyzapAds.VideoAd.addEventListener(HeyzapAds.VideoAd.Events.CLICKED,function(){d.adManager.onAdClicked.dispatch(HeyzapAds.VideoAd.Events.CLICKED)}),HeyzapAds.VideoAd.show().then(function(){d.adManager.onContentPaused.dispatch()},function(a){d.adManager.onContentResumed.dispatch()});break;case b.Rewarded:HeyzapAds.IncentivizedAd.addEventListener(HeyzapAds.IncentivizedAd.Events.HIDE,function(){d.adManager.onContentResumed.dispatch(HeyzapAds.IncentivizedAd.Events.HIDE)}),HeyzapAds.IncentivizedAd.addEventListener(HeyzapAds.IncentivizedAd.Events.SHOW_FAILED,function(){d.adManager.onContentResumed.dispatch(HeyzapAds.IncentivizedAd.Events.SHOW_FAILED)}),HeyzapAds.IncentivizedAd.addEventListener(HeyzapAds.IncentivizedAd.Events.CLICKED,function(){d.adManager.onAdClicked.dispatch(HeyzapAds.IncentivizedAd.Events.CLICKED)}),HeyzapAds.IncentivizedAd.show().then(function(){d.adManager.onContentPaused.dispatch()},function(a){d.adManager.onContentResumed.dispatch()});break;case b.Banner:HeyzapAds.BannerAd.show(c).then(function(){},function(a){})}},a.prototype.preloadAd=function(a){this.adsEnabled&&a===b.Rewarded&&HeyzapAds.IncentivizedAd.fetch().then(function(){},function(a){})},a.prototype.destroyAd=function(a){this.adsEnabled&&a===b.Banner&&HeyzapAds.BannerAd.destroy().then(function(){},function(a){})},a.prototype.hideAd=function(a){this.adsEnabled&&a===b.Banner&&HeyzapAds.BannerAd.hide().then(function(){},function(a){})},a}();a.CordovaHeyzap=c}(b=a.AdProvider||(a.AdProvider={}))}(Fabrique||(Fabrique={}));var AdManager=Fabrique.Plugins.AdManager,Fabrique;!function(a){var b;!function(a){var b=function(){function a(a,b){this.adsManager=null,this.googleEnabled=!1,this.canPlayAds=!1,this.adTagUrl="",this.adRequested=!1,this.adManager=null,"undefined"!=typeof google&&(this.googleEnabled=!0,this.gameContent="string"==typeof a.parent?document.getElementById(a.parent):a.parent,this.gameContent.style.position="absolute",this.gameContent.style.width="100%",this.gameContent.style.height="100%",this.adContent=this.gameContent.parentNode.appendChild(document.createElement("div")),this.adContent.id="phaser-ad-container",this.adContent.style.position="absolute",this.adContent.style.zIndex="9999",this.adContent.style.display="none",this.fauxVideoElement=this.gameContent.parentNode.appendChild(document.createElement("video")),this.fauxVideoElement.id="phaser-ad-faux-video",this.fauxVideoElement.style.position="absolute",this.fauxVideoElement.style.zIndex="999",this.fauxVideoElement.style.display="none",this.adTagUrl=b,this.game=a,this.adDisplay=new google.ima.AdDisplayContainer(this.adContent,this.fauxVideoElement),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale("nl"),this.adLoader=new google.ima.AdsLoader(this.adDisplay),this.adLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdManagerLoader,!1,this),this.adLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1))}return a.prototype.setManager=function(a){this.adManager=a},a.prototype.requestAd=function(a){if(!this.googleEnabled)return void this.onContentResumeRequested();this.adDisplay.initialize();var b=new google.ima.AdsRequest;b.adTagUrl=this.adTagUrl+this.parseCustomParams(a);var c=window.innerWidth,d=window.innerHeight;b.linearAdSlotWidth=c,b.linearAdSlotHeight=d,b.nonLinearAdSlotWidth=c,b.nonLinearAdSlotHeight=d/3,this.game.device.iOS&&(this.fauxVideoElement.style.width=c+"px",this.fauxVideoElement.style.height=d+"px"),b.forceNonLinearFullSlot=!0;try{this.adLoader.requestAds(b)}catch(e){console.log(e),this.onContentResumeRequested()}},a.prototype.preloadAd=function(){},a.prototype.destroyAd=function(){},a.prototype.hideAd=function(){},a.prototype.onAdManagerLoader=function(a){var b=new google.ima.AdsRenderingSettings;b.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.adsManager=a.getAdsManager(this.fauxVideoElement,b),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.onAdEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdEvent.bind(this));try{this.adContent.style.display="block",this.game.device.iOS&&(this.fauxVideoElement.style.display="block");var c=window.innerWidth,d=window.innerHeight;this.adsManager.init(c,d,google.ima.ViewMode.NORMAL),this.adsManager.start()}catch(e){this.onAdError()}},a.prototype.onAdEvent=function(a){if(console.log("onAdEvent",arguments),a.type==google.ima.AdEvent.Type.CLICK)this.adManager.onAdClicked.dispatch();else if(a.type==google.ima.AdEvent.Type.LOADED){var b=a.getAd();console.log(b),b.isLinear()||this.onContentResumeRequested()}else a.type===google.ima.AdEvent.Type.ALL_ADS_COMPLETED&&this.onContentResumeRequested()},a.prototype.onAdError=function(){console.log("gneric ad error"),null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null),this.onContentResumeRequested()},a.prototype.onContentPauseRequested=function(){console.log("onContentPauseRequested",arguments),this.adManager.onContentPaused.dispatch()},a.prototype.onContentResumeRequested=function(){return"undefined"==typeof google?void this.adManager.onContentResumed.dispatch():(console.log("onContentResumeRequested",arguments),this.adContent.style.display="none",this.game.device.iOS&&(this.fauxVideoElement.style.display="none"),void this.adManager.onContentResumed.dispatch())},a.prototype.parseCustomParams=function(a){if(void 0!==a){var b="";for(var c in a){b.length>0&&(b+="&");var d=Array.isArray(a[c])?a[c].join(","):a[c];b+=c+"="+d}return"&cust_params="+encodeURIComponent(b)}return""},a}();a.Ima3=b}(b=a.AdProvider||(a.AdProvider={}))}(Fabrique||(Fabrique={}));